# SQL Лекция 2: Четене, Филтриране и Промяна на Данни

Добре дошли в втората стъпка от работата с бази данни!

В предишната лекция научихме как се **създават таблици** (`CREATE TABLE`) и как се **добавят данни** (`INSERT INTO`). В тази лекция ще разгледаме детайлно командите, с които **четем**, **филтрираме**, **обновяваме** и **изтриваме** данни.

---

## Подготовка: Нашата тестова таблица

Преди да започнем, нека имаме готова таблица с данни. Изпълнете следното:

```sql
CREATE TABLE IF NOT EXISTS employees (
    id       INTEGER PRIMARY KEY,
    name     TEXT,
    position TEXT,
    salary   REAL
);

INSERT INTO employees (name, position, salary) VALUES ('Ivan Petrov',    'Software Engineer', 4500.50);
INSERT INTO employees (name, position, salary) VALUES ('Maria Ivanova',  'Designer',          3800.00);
INSERT INTO employees (name, position, salary) VALUES ('Georgi Dimitrov','Team Lead',         6200.00);
INSERT INTO employees (name, position, salary) VALUES ('Elena Stoyanova', 'QA Engineer',      4100.00);
INSERT INTO employees (name, position, salary) VALUES ('Nikolay Todorov', 'Software Engineer', 4500.50);
```

> **Важно:** Ако вече имате тази таблица от предишната лекция, изпълнете `DROP TABLE employees;` първо, а след това горните заявки.

---

## 1. SELECT — Четене на данни

`SELECT` е командата, с която **извличаме данни** от таблица. Тя е може би най-важната SQL команда.

### Синтаксис

```sql
SELECT колона1, колона2, ... FROM таблица;
```

### Пример 1: Всички колони

Символът `*` означава "всички колони":

```sql
SELECT * FROM employees;
```

| id | name             | position           | salary  |
|----|------------------|--------------------|---------|
| 1  | Ivan Petrov      | Software Engineer  | 4500.50 |
| 2  | Maria Ivanova    | Designer           | 3800.00 |
| 3  | Georgi Dimitrov  | Team Lead          | 6200.00 |
| 4  | Elena Stoyanova  | QA Engineer        | 4100.00 |
| 5  | Nikolay Todorov  | Software Engineer  | 4500.50 |

### Пример 2: Само определени колони

Вместо `*`, изброявате само колоните, които ви интересуват:

```sql
SELECT name, salary FROM employees;
```

| name             | salary  |
|------------------|---------|
| Ivan Petrov      | 4500.50 |
| Maria Ivanova    | 3800.00 |
| Georgi Dimitrov  | 6200.00 |
| Elena Stoyanova  | 4100.00 |
| Nikolay Todorov  | 4500.50 |

> **Съвет:** В реалните проекти избягвайте `SELECT *` — по-добре изброявайте конкретните колони. Така кодът е по-ясен и по-бърз.

---

## 2. WHERE — Филтриране на резултати

`WHERE` ви позволява да зададете **условие** — базата данни ще върне само редовете, за които условието е изпълнено.

### Синтаксис

```sql
SELECT * FROM таблица WHERE условие;
```

### Оператори за сравнение

| Оператор | Значение           | Пример              |
|----------|--------------------|---------------------|
| `=`      | равно              | `salary = 4500.50`  |
| `<>`     | различно (≠)       | `position <> 'Designer'` |
| `>`      | по-голямо от       | `salary > 4000`     |
| `<`      | по-малко от        | `salary < 5000`     |
| `>=`     | по-голямо или равно| `salary >= 4500`    |
| `<=`     | по-малко или равно | `salary <= 4100`    |

### Пример 3: Служители с заплата над 4000

```sql
SELECT * FROM employees WHERE salary > 4000;
```

### Пример 4: Намиране по точна стойност

```sql
SELECT * FROM employees WHERE name = 'Maria Ivanova';
```

---

## 3. AND и OR — Комбиниране на условия

Можете да комбинирате няколко условия с `AND` (и двете трябва да са верни) или `OR` (поне едното трябва да е вярно).

### Пример 5: AND — две условия едновременно

Служители на позиция "Software Engineer" **И** заплата над 4200:

```sql
SELECT * FROM employees
WHERE position = 'Software Engineer' AND salary > 4200;
```

### Пример 6: OR — поне едно условие

Служители, които са или "Designer", или "Team Lead":

```sql
SELECT * FROM employees
WHERE position = 'Designer' OR position = 'Team Lead';
```

> **Правило:** `AND` е по-силен от `OR`. Когато комбинирате и двете, използвайте скоби `()`, за да сте сигурни в реда на изпълнение.

---

## 4. UPDATE — Промяна на съществуващи данни

`UPDATE` променя стойностите в един или повече редове на таблицата.

### Синтаксис

```sql
UPDATE таблица
SET колона1 = нова_стойност1, колона2 = нова_стойност2
WHERE условие;
```

### Пример 7: Повишение на заплата

Иван Петров е повишен и заплатата му се увеличава:

```sql
UPDATE employees
SET salary = 5200.00
WHERE name = 'Ivan Petrov';
```

### Пример 8: Промяна на две колони наведнъж

```sql
UPDATE employees
SET position = 'Senior QA Engineer', salary = 4800.00
WHERE name = 'Elena Stoyanova';
```

> **Внимание:** Ако пропуснете `WHERE`, **всички редове** в таблицата ще бъдат обновени! Винаги проверявайте условието си, преди да изпълните `UPDATE`.

---

## 5. DELETE — Изтриване на редове

`DELETE FROM` изтрива **редове** от таблица (за разлика от `DROP TABLE`, което изтрива цялата таблица).

### Синтаксис

```sql
DELETE FROM таблица WHERE условие;
```

### Пример 9: Изтриване на конкретен запис

```sql
DELETE FROM employees WHERE id = 2;
```

### Пример 10: Изтриване по условие

Изтриваме всички служители с заплата под 4000:

```sql
DELETE FROM employees WHERE salary < 4000;
```

> **Внимание:** Ако пропуснете `WHERE`, ще изтриете **всички редове** в таблицата (но самата таблица остава). Бъдете внимателни!

---

## 6. ORDER BY — Сортиране на резултатите *(Бонус)*

`ORDER BY` сортира върнатите редове по дадена колона.

```sql
SELECT * FROM employees ORDER BY salary;          -- от най-малко към най-много (ASC по подразбиране)
SELECT * FROM employees ORDER BY salary DESC;     -- от най-много към най-малко
SELECT * FROM employees ORDER BY name ASC;        -- по азбучен ред
```

## 7. LIMIT — Ограничаване на броя резултати *(Бонус)*

`LIMIT` казва на базата данни да върне само определен брой редове:

```sql
SELECT * FROM employees ORDER BY salary DESC LIMIT 3;  -- Топ 3 най-добре платени
```

---

## Обобщение

| Команда     | Какво прави                                  |
|-------------|----------------------------------------------|
| `SELECT`    | Чете данни от таблица                        |
| `WHERE`     | Филтрира редовете по условие                 |
| `AND / OR`  | Комбинира няколко условия                    |
| `UPDATE`    | Променя стойностите в съществуващи редове    |
| `DELETE`    | Изтрива редове от таблица                    |
| `ORDER BY`  | Сортира резултатите                          |
| `LIMIT`     | Ограничава броя върнати редове               |

---

## Задачи

Използвайте таблицата `employees` от подготовката в началото на лекцията.

### Задача 1: Прочетете само имената и длъжностите
Напишете `SELECT` заявка, която връща само колоните `name` и `position` за **всички** служители.

---

### Задача 2: Филтриране по длъжност
Напишете заявка, която връща **всички данни** само за служителите с длъжност `'Software Engineer'`.

---

### Задача 3: Комбинирано условие
Напишете заявка, която връща имената на служителите, чиято заплата е **между 4000 и 5000** (включително).
*(Подсказка: Използвайте `AND` с два оператора за сравнение.)*

---

### Задача 4: Обновяване на данни
Георги Димитров е преименуван на нова позиция — `'Engineering Manager'` — и получава нова заплата от `7500.00`. Напишете `UPDATE` заявка, която отразява тези промени.
След обновяването напишете `SELECT`, за да проверите резултата.

---

### Задача 5: Изтриване и проверка
Напишете `DELETE` заявка, която изтрива **всички служители** с длъжност `'QA Engineer'`.
След изтриването напишете `SELECT *` и проверете дали записите са изчезнали.

---

*Следваща лекция: агрегатни функции (`COUNT`, `SUM`, `AVG`, `MIN`, `MAX`) и групиране с `GROUP BY`.*
