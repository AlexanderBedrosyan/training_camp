# Класови атрибути (Class Attributes)

## Какво е инстанционен (instance) атрибут?

Инстанционен атрибут се дефинира обикновено в конструктора `__init__` и принадлежи на конкретен обект (инстанция). Всеки обект има собствено копие на тези атрибути.

Пример:

```python
class Car:
    def __init__(self, make, model):
        self.make = make   # инстанционен атрибут
        self.model = model # инстанционен атрибут

c1 = Car('Toyota', 'Corolla')
c2 = Car('Honda', 'Civic')
print(c1.make, c1.model)  # Toyota Corolla
print(c2.make, c2.model)  # Honda Civic
```

## Какво е класов атрибут (class attribute)?

Класов атрибут е дефиниран в тялото на класа (извън методите) и е споделен между всички инстанции на този клас (освен ако бъде "скрит" от инстанцията чрез задаване на атрибут със същото име в `self`).

Пример:

```python
class Car:
    wheels = 4  # класов атрибут (споделен)

c1 = Car()
c2 = Car()
print(c1.wheels, c2.wheels)  # 4 4

# Ако променим чрез класа, промяната засяга всички инстанции:
Car.wheels = 3
print(c1.wheels, c2.wheels)  # 3 3

# Ако променим чрез инстанция, ние създаваме/скриваме инстанционен атрибут:
c1.wheels = 6
print(c1.wheels)  # 6  (инстанционен, "скрива" класовия)
print(c2.wheels)  # 3  (все още наследява класовия)
```

## Таблица: бързо сравнение

| Характеристика | Инстанционен атрибут (`self.x`) | Класов атрибут (`Class.x`) |
|---|---:|---:|
| Обхват | Единствено за обекта | Споделен за всички инстанции на класа |
| Дефиниция | В `__init__` или друг метод, чрез `self` | В тялото на класа (извън методите) |
| Смяна | Само за конкретната инстанция (освен ако през класа) | Променя се за всички, ако се променя през класа |
| Използване | Състояние, специфично за обекта | Константи, настройки, броячи, кешове, регистри |

## Честни сценарии и съвети

- Използвайте класови атрибути за стойности, които са общи за всички инстанции: константи, стойности по подразбиране, броячи на инстанции, регистрационни структури, кешове, настройки.
- Внимавайте с мутабилни класови атрибути (списъци, речници): те ще бъдат споделени и промени от една инстанция ще видими за всички. Ако не искате това, използвайте `None` като default и инициализирайте мутабилната структура в `__init__`.

Пример (капан с мутабилен класов атрибут):

```python
class Team:
    members = []  # ОПАСНО: споделен mutable обект

t1 = Team()
t2 = Team()
Team.members.append('Alice')
print(t1.members)  # ['Alice']
print(t2.members)  # ['Alice']

# Правилен начин:
class TeamSafe:
    def __init__(self):
        self.members = []  # отделен списък за всяка инстанция
```

## Примери за практични употреби

1) Брояч на инстанции:

```python
class User:
    count = 0  # класов атрибут

    def __init__(self, name):
        self.name = name
        User.count += 1

u1 = User('A')
u2 = User('B')
print(User.count)  # 2
```

2) Класов атрибут като конфигурация/константа:

```python
class Circle:
    PI = 3.14159  # класова константа

    def __init__(self, r):
        self.r = r

    def area(self):
        return self.PI * self.r * self.r
```

3) Използване на `@classmethod` за достъп/промяна на класов атрибут:

```python
class Config:
    debug = False

    @classmethod
    def enable_debug(cls):
        cls.debug = True
```

## Поведение при наследяване

Класовите атрибути могат да бъдат презаписвани от подклас. Това позволява дефиниране на общо поведение в базов клас и специфични стойности в подкласовете.

```python
class Animal:
    species = 'Unknown'

class Dog(Animal):
    species = 'Canis familiaris'

print(Animal.species)  # Unknown
print(Dog.species)     # Canis familiaris
```

## Практически съвети и добри практики

- Използвайте главни букви за класови константи: `MAX_LIMIT = 100`.
- За mutable по-често използвайте `None` в класа и инициализация в `__init__`.
- Ако искате споделено състояние (като кеш, registry или брояч), използвайте класови атрибути и предвидете как тяхната промяна ще засяга съществуващите инстанции.
- За модификация на класова стойност от метод използвайте `cls` в `@classmethod` (по-ясно и правилно при наследяване).

## Малка диаграма (текстово представяне)

Клас
|-- class_attr (споделен)
|-- методи

Инстанция A
|-- self.attrA (собствен)
|-- (достъпва shared class_attr ако няма собствена attrA)

Инстанция B
|-- self.attrB (собствен)
|-- (също достъпва shared class_attr)

## Заключение

- Използвайте `__init__` за данни, които са специфични за всяка инстанция.
- Използвайте класови атрибути за стойности и структури, които трябва да бъдат споделени между инстанциите (или за константи).
- Внимавайте при mutable класови атрибути и използвайте `@classmethod`/`cls` когато променяте класово състояние.

---